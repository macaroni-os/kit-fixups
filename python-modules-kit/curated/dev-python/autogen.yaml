oddball_core_deps:
  defaults:
    python_compat: python3+
    du_pep517: ~
  generator: pypi-compat-1
  packages:
    - packaging:
        version: '21.3'
        compat: '20.9'
        blocker: "!<=dev-python/packaging-18.0"
        python_compat: python3+
        pydeps:
          py:all:
            - pyparsing < 3
    - tomli:
        du_setuptools: autostub
        version: 2.0.0
        desc: "A lil' TOML parser"
        license: MIT
        body: |
          DOCS=( README.md )
    - testtools:
        compat: 2.4.0
        blocker: '!<dev-python/testtools-2.5.0-r1'
        revision:
          2.5.0: 1
        pydeps:
          py:all:build:
            - setuptools
            - pbr
          py:all:
            - pbr

sqlalchemy:
  defaults:
    python_compat: python2+
  generator: pypi-compat-1
  packages:
    - sqlalchemy:
        pypi_name: SQLAlchemy
        du_pep517: setuptools
        pydeps:
          py:all:
            - typing-extensions
          py:all:build:
            - cython
        compat: 1.4.7
        blocker: "!<dev-python/sqlalchemy-2.0.20"

stuff_not_dev_python:
  defaults:
    python_compat: python3+
  generator: pypi-compat-1
  packages:
    - python-gitlab:
        cat: dev-vcs
        pydeps:
          py:all:
            - requests
            - requests-toolbelt
          py:3.7:
            - typing-extensions

glances:
  defaults:
    python_compat: python3+
  generator: pypi-simple-1
  packages:
    - pystache:
        du_pep517: setuptools
appdirs:
  defaults:
   python_compat: python3+
  generator: pypi-simple-1
  packages:
  - appdirs:
     du_pep517: generator

tensorflow:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-simple-1
  packages:
    - grpcio-tools:
        depend: |
          =dev-libs/protobuf-3*
    - grpcio:
        pydeps:
          - six >= 1.5.2
          - grpcio-tools >= 1.42.0
    - pbr:
        python_compat: python2+
    - pyfuse3:
        pydeps:
          - trio
        rdepend:
          sys-fs/fuse:3
        body: |
          distutils_enable_tests pytest

tenacity:
  defaults: 
    cat: dev-python
    python_compat: python3+
  generator: pypi-compat-1
  packages:
    - tenacity:
        compat: '7.0.0'
        blocker: '!<dev-python/tenacity-8'

rapid_photo_downloder_stuff:
  # Things needed by media-gfx/rapid-photo-downloader in media-kit.
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-simple-1
  packages:
    - colour:
        pydeps:
          - d2to1
    - d2to1
    - easygui:
        python_use: tk
        body: |
          src_prepare() {
            default
            touch ${S}/README.md
          }
    - gphoto2:
        rdepend: |
          media-libs/libgphoto2
    - pymediainfo:
        pydeps:
          py:3:
            - importlib_metadata
          py:all:build:
            - setuptools_scm
        rdepend:
          media-libs/libmediainfo
    - rawkit

tornado_stuff:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-compat-1
  packages:
    - service_identity:
        compat:
          version: 21.1.0
        blocker: "!<=dev-python/service_identity-23.1.0"
        revision:
          23.1.0: 1
        du_pep517: hatchling
        license: MIT
        pydeps:
          - pyasn1
          - pyasn1-modules
          - pyopenssl
          - attrs
          - cryptography
          - six

github_pythons:
  generator: pypi-compat-1
  defaults:
    python_compat: python3+
  packages:
    - cachecontrol:
        desc: The httplib2 caching algorithms packaged up for use with requests.
        iuse: test
        python_compat: python3+ pypy3
        github:
          query: tags
          user: ionrock
        license: Apache-2.0
        homepage: https://github.com/ionrock/cachecontrol/ https://pypi.org/project/CacheControl/
        pydeps:
          py:all:build:
            - requests
            - msgpack
          use:test:
            - cherrypy
            - lockfile
            - mock
        body: |
          post_src_unpack() {
            rm "${S}"/tests/__init__.py || die
          }


github_stuff:
  generator: python-github-1
  defaults:
    python_compat: python3+
  packages:
    - docker-py:
        version: '5.0.3'
        github:
          query: releases
          user: docker
        tarball: docker-{version}.tar.gz
        license: BSD
        desc: Python client for Docker
        homepage: https://github.com/docker/docker-py
        pydeps:
          - requests >= 2.24.0
          - six >= 1.4.0
          - websocket-client >= 0.32.0
        body: |
          distutils_enable_sphinx docs 'dev-python/recommonmark' '>=dev-python/sphinx-1.4.6'
          src_unpack() {
            default
            mv ${WORKDIR}/docker-* ${S} || die
          }
          src_prepare() {
            default
            # localhost has a better chance of being in /etc/hosts
            sed -i -e 's:socket[.]gethostname():"localhost":' tests/unit/api_test.py || die
            distutils-r1_src_prepare
          }
    - parse_type:
        github:
          query: tags
          user: jenisys
        license: BSD
        desc: Extension to the parse module
        homepage: https://pypi.org/project/parse-type/
        pydeps:
          - parse >= 1.18.0
          - six >= 1.11
        body: |
          src_prepare() {
            default
            # hack to disable 2to3 which we don't need anyway and setuptools 58+ dies on
            sed -i -e 's/use_2to3/foo_2to3/g' setup.py || die
          }
    - rdflib:
        github:
          query: releases
          user: RDFLib
        license: BSD
        desc: Python library for working with RDF, a simple powerful language to represent information
        homepage: https://pypi.org/project/rdflib/
        du_pep517: standalone
        pydeps:
          - html5lib
          - isodate
          - pyparsing
          - poetry-core
    - lark:
        github:
          query: tags
          user: lark-parser
        license: BSD
        homepage: https://pypi.org/project/lark
        desc: Parsing toolkit for Python, built with a focus on ergonomics, performance and modularity.

aiobotostuff:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-simple-1
  packages:
    - aioitertools:
        license: MIT
        pydeps:
          - typing-extensions
    - typing-extensions:
        version: 4.7.1
        du_pep517: flit
    - wrapt

stuff_orphaned_in_python2:
  defaults:
    cat: dev-python
    python_compat: python2_7
  generator: pypi-simple-1
  packages:
    - configparser:
        license: MIT
        version: 4.0.2
        pydeps:
          py:all:
            - backports
          py:all:build:
            - setuptools_scm
        body: |
          post_src_install() {
            # This is installed by backports:
            rm -f ${D}/usr/lib*/python*/site-packages/backports/__init__.py
          }

dev_python_namespaces_rule:
  defaults:
    cat: dev-python
    python_compat: python3+
    template: namespace.tmpl
  generator: simple
  packages:
    - namespace-zope:
        version: '1'
        python_compat: python2+ pypy3
        namespace: zope

dev_python_setuptools_rule:
  defaults:
    cat: dev-python
    python_compat: python3+
    du_pep517: setuptools
    pydeps:
      # Note: using du_pep517: setuptools
      #       automatically add setuptools as BDEPEND.
      #       But this just adds it to DEPEND which
      #       seems better in some conditions to help the solver.
      py:all:build:
        - setuptools
  generator: pypi-simple-1
  packages:
    - python-dateutil:
        license: BSD
        desc: "Extensions to the standard Python datetime module"
        rdepend: 'sys-libs/timezone-data'
        patches:
          - 0001-zoneinfo-Get-timezone-data-from-system-tzdata.patch
        pydeps:
          py:all:build:
            - six
            - setuptools_scm
          py:all:runtime:
            - six
        body: |
          python_prepare_all() {
            # don't install zoneinfo tarball
            sed -i '/package_data=/d' setup.py || die

            distutils-r1_python_prepare_all
          }

dev_python_compat_rule:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-compat-1
  packages:
    - arrow:
        python_compat: python3+
        desc: "Better dates and times for Python"
        license: Apache-2.0
        compat: '0.9.0'
        blocker: '!<dev-python/arrow-1.1.1-r1'
        revision:
          1.1.1: 1
        pydeps:
          py:all:
            - python-dateutil
          py:2:
            - backports-functools-lru-cache
            - pathlib
    - asyncpg:
        python_compat: python3+
        desc: A database interface library designed specifically for PostgresSQL and Python/asyncio.
        license: Apache-2.0
        homepage: |
          https://github.com/MagicStack/asyncpg
    - automat:
        desc: Self-service finite-state machines for the programmer on the go
        compat: '20.2.0'
        revision:
          22.10.0: 1
        blocker: '!<=dev-python/automat-22.10.0'
        python_compat: python3+ pypy3
        pydeps:
          py:all:build:
            - attrs
            - six
          py:2:build:
            - m2r
        rdepend: |
          ${DEPEND}
        body: |
          src_unpack() {
            default
            mv ${WORKDIR}/A* ${S} || die
          }
          python_prepare_all() {
            # avoid a setuptools_scm dependency
            sed -r -i "s:use_scm_version=True:version='${PV}': ;
              s:[\"']setuptools[_-]scm[\"'](,|)::" setup.py || die
            distutils-r1_python_prepare_all
          }
          pkg_postinst() {
            einfo "For additional visualization functionality install these optional dependencies"
            einfo "    >=dev-python/twisted-16.1.1"
            einfo "    media-gfx/graphviz[python]"
          }

    - Babel:
        python_compat: python2+
        compat: '2.9.1'
        blocker: '!<dev-python/Babel-2.10'
        pypi_name: babel
        revision:
          2.10.1: 1
        pydeps:
          - pytz
    - chardet:
        compat: '4.0.0'
        blocker: '!<dev-python/chardet-5.0.0-r1'
        revision:
          5.0.0: 1
    - configargparse:
        compat: '1.5.5'
        blocker: '!<dev-python/configargparse-1.7.0'
        pypi_name: ConfigArgParse
    - docutils:
        du_pep517: generator
        compat: '0.18.1'
        blocker: '!<dev-python/docutils-0.19-r1'
        revision:
          '0.19': 1
    - dnspython:
        python_compat: python3+ pypy3
        compat: '1.16.0'
        license: 'ISC'
        revision:
          2.2.1: 1
        blocker: '!<=dev-python/dnspython-2.2.1'
        rdepend: |
          ${DEPEND}
        pydeps:
          py:all:build:
            - idna
          py:3:build:
            - cryptography
          py:2:build:
            - pycryptodome
            - ecdsa
        body: |
          src_prepare() {
            sed -i -e 's|^license =.*|license = {text = "ISC"}|g' pyproject.toml
            distutils-r1_src_prepare
          }

    - entrypoints:
        version: '0.3'
        python_compat: python2+
    - pyjwt:
        inherit:
          - eutils
        pypi_name: PyJWT
        python_compat: python3+
        compat: '1.7.1'
        pydeps:
          py:all:build:
            - setuptools
        blocker: '!<dev-python/pyjwt-2.3.0-r1'
        revision:
          2.3.0: 1
        body: |
          pkg_postinst() {
            elog "Available optional features:"
            optfeature "cryptography" ">=dev-python/cryptography-1.4.0"
            optfeature "flake8" "dev-python/flake8 dev-python/flake8-import-order dev-python/pep8-naming"
          }
    - et_xmlfile:
        python_compat: python2+
        pydeps:
          - lxml
        license: MIT
        homepage: |
          https://pypi.org/project/et_xmlfile/
    - flake8:
        compat: '3.9.2'
        blocker: '!<dev-python/flake8-4'
        desc: "A wrapper around PyFlakes, pep8 & mccabe"
        license: MIT
        homepage: |
          https://gitlab.com/pycqa/flake8 https://pypi.org/project/flake8/
        pydeps:
          py:all:
            - pyflakes
            - pycodestyle
          py:all:post:
            - mccabe
        body: |
          src_prepare() {
            # remove version-limited dep
            sed -i -e '/importlib-metadata/d' setup.cfg || die
            distutils-r1_src_prepare
          }
    - idna:
        compat: '2.9'
        blocker: '!<dev-python/idna-3'
        license: BSD
        du_pep517: flit
        revision:
          '3.4': 1
    - importlib_resources:
        compat: '3.3.1'
        python_compat: 'pypy3 python3+'
        blocker: '!<dev-python/importlib_resources-4'
        license: Apache-2.0
        pydeps:
          py:3,pypy3:
            - zipp
          py:all:build:
            - toml
            - setuptools_scm >= 3.4.1
        body: |
          distutils_enable_sphinx docs dev-python/rst-linker dev-python/jaraco-packaging
    - jdcal:
        python_compat: python2+ pypy3
        homepage: |
          https://github.com/phn/jdcal
        license: BSD
    - jsonschema:
        version: 4.5.1
        python_compat: python3+
        du_setuptools: autostub
        pydeps:
         py:all:build:
          - attrs >= 17.4.0
          - importlib_metadata
          - pyrsistent
        py:2:build:
          - functools32
        py:all:
          - fqdn
          - idna
          - isoduration
          - jsonpointer >= 1.13
          - rfc3339-validator
          - rfc3986-validator
          - rfc3987
          - uri_template
          - webcolors >= 1.11
          - strict-rfc3339
          - importlib_resources
    - oauthlib:
        pydeps:
          - pyjwt
          - blinker
          - cryptography
    - openpyxl:
        compat: '2.6.4'
        blocker: '!<dev-python/openpyxl-3'
        homepage: |
          https://openpyxl.readthedocs.io/
          https://pypi.org/project/openpyxl/
        license: MIT
        pydeps:
          - et_xmlfile
          - jdcal
        body: ""
    - markdown:
        compat: '3.1.1'
        blocker: '!<dev-python/markdown-3.2'
        python_compat: python3+ pypy3
        desc: Python implementation of the markdown markup language
        homepage: |
          https://python-markdown.github.io/
          https://pypi.org/project/Markdown/
          https://github.com/Python-Markdown/markdown
        license: BSD
        pypi_name: Markdown
        pydeps:
          py:3,pypy3:
            - importlib_metadata
    - mako:
        compat: '1.1.6'
        blocker: "!<dev-python/mako-1.2.0-r1"
        revision:
          1.2.0: 1
        pypi_name: Mako
        inherit:
          - eutils
        python_compat: python2+
        pydeps:
          - importlib_metadata
          - markupsafe
        body: |
          pkg_postinst() {
            elog "Optional dependencies:"
            optfeature "caching support" dev-python/beaker
          }
    - more-itertools:
        version: '8.12.0'
        compat: '4.3.0'
        blocker: '!<dev-python/more-itertools-8'
        homepage: 'https://pypi.org/project/more-itertools/'
    - msgpack:
        compat: '0.6.2'
        blocker: '!dev-python/msgpack-1.0.7 !<=dev-python/msgpack-1.0.5'
        revision:
          1.0.5: 1
          1.0.7: 1
        iuse: native-extensions
        version:
          latest:
            keywords: next
          1.0.5:
            keywords: '*'
        body: |
          python_prepare_all() {
            # Remove pre-generated cython files
            rm msgpack/{_packer,_unpacker,_cmsgpack}.pyx || die

            if ! use native-extensions ; then
              sed -i -e "/have_cython/s:True:False:" setup.py || die
            fi
            distutils-r1_python_prepare_all
          }
    - mwparserfromhell:
        license: MIT
        compat: '0.5.4'
        blocker: '!<dev-python/mwparserfromhell-0.6'
    - pycountry:
        compat: '18.12.8'
        blocker: '!<dev-python/pycountry-19.7.15'
        homepage: https://github.com/flyingcircusio/pycountry
        license: LGPL-2.1
        restrict: test
    - pyhamcrest:
        du_pep517: hatchling
        compat:
          version: '1.9.0'
          pypi_name: PyHamcrest
        blocker: '!<dev-python/pyhamcrest-2.0.0'
        homepage: https://github.com/hamcrest/PyHamcrest
        license: BSD
        pydeps:
          py:3:build:
            - hatch-vcs
    - pyopenssl:
        compat: '21.0.0'
        pypi_name: pyOpenSSL
        blocker: '!<=dev-python/pyopenssl-23.1.1'
        homepage: https://github.com/pyca/pyopenssl
        license: Apache-2.0
        revision:
          23.1.1: 1
    - pyrsistent:
        compat: '0.16.0'
        blocker: '!<dev-python/pyrsistent-0.16.0'
        python_compat: python3+ pypy3
        license: MIT
        homepage: https://github.com/tobgu/pyrsistent/ https://pypi.org/project/pyrsistent/
        rdepend_compat: |
          dev-python/six[${PYTHON_USEDEP}]
    - pyxattr:
        compat: '0.6.1'
        blocker: '!<dev-python/pyxattr-0.7.1'
        python_compat: python3+
        rdepend: 'sys-apps/attr:='
        depend: 'sys-apps/attr:='
        desc: Python interface to xattr
        homepage: https://pyxattr.k1024.org
        license: LGPL-2.1
        body: |
          distutils_enable_tests pytest
          distutils_enable_sphinx doc dev-python/recommonmark

          python_prepare_all() {
            sed -i -e 's:, "-Werror"::' setup.py || die
            # Bug 548486
            sed -e "s:html_theme = 'default':html_theme = 'classic':" -i doc/conf.py || die
            distutils-r1_python_prepare_all
          }
    - pyyaml:
        revision:
          6.0.1: 1
        compat: '5.4.1'
        blocker: '!<dev-python/pyyaml-6.0'
        python_compat: python3+ pypy3
        pypi_name: PyYAML
        desc: YAML parser and emitter for Python
        homepage: |
          https://pyyaml.org/wiki/PyYAML
          https://pypi.org/project/PyYAML/
          https://github.com/yaml/pyyaml
        license: MIT
        iuse: examples +libyaml
        depend: |
          libyaml? ( dev-libs/libyaml )
        rdepend: |
          libyaml? ( dev-libs/libyaml )
        pydeps:
          use:libyaml:build:
            - cython < 3
          use:libyaml:
            - cython < 3
        body: |
          python_configure_all() {
            mydistutilsargs=( $(use_with libyaml) )
          }

          python_install_all() {
            distutils-r1_python_install_all
            if use examples; then
              dodoc -r examples
              docompress -x /usr/share/doc/${PF}
            fi
          }

    - pyzmq:
        version: '25.1.2'
        compat: '19.0.2'
        blocker: '!<=dev-python/pyzmq-19.0.2'
        python_compat: python3+ pypy{,3}
        rdepend: |
          >=net-libs/zeromq-4.2.2-r2:=[drafts]
        inherit:
          - toolchain-funcs
          - flag-o-matic
        license: LGPL-3
        desc: Lightweight and super-fast messaging library built on top of the ZeroMQ library
        homepage: |
          http://www.zeromq.org/bindings:python https://pypi.org/project/pyzmq/
        pydeps:
          py:all:build:
            - cython
          py:all:
            - py
            - cffi
          py:2:
            - gevent
        body: |
          python_configure_all() {
            tc-export CC
            append-cppflags -DZMQ_BUILD_DRAFT_API=1
          }
    - scons:
        du_pep517: generator
        compat: 3.1.2
        blocker: '!<dev-util/scons-4.0.0'
        pypi_name: SCons
        desc: Extensible Python-based build utility
        homepage: https://www.scons.org/
        license: MIT
        cat: dev-util
        restrict: test
        body: |
          if [ "$PN"  == 'scons-compat' ]; then
            S="${WORKDIR}/scons-${PV}"
          fi
          python_install() {
            distutils-r1_python_install
            rm "${D}"/usr/*.1
            doman *.1

            if [ "$PN"  == 'scons-compat' ]; then
              rm -rf "${D}"/usr/bin
              find "${D}" -type d -name "man" -exec rm -rf \{\} \;
            fi

          }
    - setuptools:
        du_setuptools: 'no'
        desc: Collection of extensions to Distutils
        license: MIT
        blocker: '!<dev-python/setuptools-47'
        restrict: 'test'
        homepage: >
          https://github.com/pypa/setuptools
          https://pypi.org/project/setuptools/
        compat: '44.1.1'
        python_compat: python3+ pypy3
        pydeps:
          py:all:post:
            - certifi >= 2016.9.26
        depend: |
          app-arch/unzip
        body: |
          SETUPTOOLS_USE_DISTUTILS=stdlib
          python_install() {
            export DISTRIBUTE_DISABLE_VERSIONED_EASY_INSTALL_SCRIPT=1
            distutils-r1_python_install
            # Remove any wrapper
            if [ "$PN"  == 'setuptools-compat' ]; then
              rm -rf ${D}/usr/bin
            fi

          }
    - xlrd:
        desc: Extract data from Excel spreadsheets
        python_compat: python2+
        homepage: |
          http://www.python-excel.org/
        license: BSD
    - xmltodict:
        desc: A python module that makes working with XML feel like you are working with JSON
        python_compat: python2+ pypy{,3}
        license: MIT
        homepage: |
          https://github.com/martinblech/xmltodict
    - yattag:
        desc: "A library to generate HTML or XML"
        license: "LGPL 2.1"
    - zstandard:
        compat: '0.14.1'
        version: '0.18.0'
        blocker: '!<dev-python/zstandard-0.15.0'
        homepage: https://pypi.org/project/zstandard/ https://github.com/indygreg/python-zstandard
        license: BSD
        iuse: test
        restrict: '!test? ( test )'
        rdepend: 'dev-python/cffi:=[${PYTHON_USEDEP}]'
        depend: 'test? ( dev-python/hypothesis[${PYTHON_USEDEP}] )'
        body: |
          python_compile() {
            local MAKEOPTS=-j1
            distutils-r1_python_compile
          }
          python_test() {
            esetup.py test
          }
    - importlib_metadata:
        version: 6.7.0
        compat: '2.1.1'
        blocker: '!<=dev-python/importlib_metadata-3.4.0-r1'
        homepage: https://importlib-metadata.readthedocs.io/
        license: Apache-2.0
        pydeps:
          py:all:
            - setuptools_scm
            - zipp
            - toml
          py:3:
            - typing-extensions >= 3.6.4
          py:2:
            - configparser >= 3.5
            - contextlib2
            - pathlib2
        body: |
          distutils_enable_sphinx "${PN}/docs" '>=dev-python/rst-linker-1.9'
        revision:
          3.4.0: 2
    - breathe:
        pydeps:
          - docutils
          - sphinx >= 3.0.0
        rdepend: |
          app-doc/doxygen
          dev-texlive/texlive-bibtexextra
          dev-texlive/texlive-fontsextra
          dev-texlive/texlive-fontutils
          dev-texlive/texlive-latex
          dev-texlive/texlive-latexextra
    - pybind11:
        python_compat: python2+
        du_setuptools: rdepend
        rdepend: dev-cpp/eigen:3
        restrict: test
        body: |
          python_install() {
            distutils-r1_python_install
            doheader -r "${S}"/pybind11/include/*
            insinto /usr/share/cmake
            doins -r "${S}"/pybind11/share/cmake/*
          }
    - zipp:
        # FL-11430:
        version: 3.9.1
        python_compat: python3+ pypy3
        compat: '1.2.0'
        blocker: '!<=dev-python/zipp-2'
        homepage: https://github.com/jaraco/zipp
        license: MIT
        pydeps:
          py:all:
            - toml
            - setuptools_scm
    - pip:
        inherit:
          - bash-completion-r1
        du_setuptools: rdepend
        compat: 20.3.4
        blocker: '!<dev-python/pip-21.0'
        restrict: test
        iuse: vanilla
        body: |
          python_prepare_all() {
            if ! use vanilla; then
              # Running pip without --target, --prefix, --root, or --user will result
              # in packages being installed systemwide. This has a tendency to break
              # python-exec if setuptools gets installed or upgraded.
              sed -e 's|options.upgrade_strategy|options.upgrade_strategy\n\n        if not options.use_user_site and not options.target_dir and not options.root_path and not options.prefix_path:\n            raise CommandError("(Gentoo) Please run pip with the --user option to avoid breaking python-exec")\n|' \
                -i src/pip/_internal/commands/install.py || die
            fi
            distutils-r1_python_prepare_all
          }
          python_install_all() {
            # Prevent dbus auto-launch
            # https://bugs.gentoo.org/692178
            export DBUS_SESSION_BUS_ADDRESS="disabled:"
            local DOCS=( AUTHORS.txt docs/html/**/*.rst )
            distutils-r1_python_install_all
            if [ "$PN" == "pip" ]; then
              COMPLETION="${T}"/completion.tmp
              # 'pip completion' command embeds full $0 into completion script, which confuses
              # 'complete' and causes QA warning when running as "${PYTHON} -m pip".
              # This trick sets correct $0 while still calling just installed pip.
              local pipcmd='import sys; sys.argv[0] = "pip"; __file__ = ""; from pip._internal.cli.main import main; sys.exit(main())'
              ${EPYTHON} -c "${pipcmd}" completion --bash > "${COMPLETION}" || die
              newbashcomp "${COMPLETION}" ${PN}
              ${EPYTHON} -c "${pipcmd}" completion --zsh > "${COMPLETION}" || die
              insinto /usr/share/zsh/site-functions
              newins "${COMPLETION}" _pip
            fi
          }
    - requests:
        compat: 2.27.1
        blocker: '!<dev-python/requests-2.28.0'
        python_compat: python3+ pypy{,3}
        desc: HTTP library for human beings
        homepage: https://requests.readthedocs.io/en/master/
        license: Apache-2.0
        iuse: socks5 +ssl
        pydeps:
          py:all:
            - certifi >= 2017.4.17
            - chardet
            - idna
            - urllib3
          py:3:
            - charset_normalizer
          use:socks5:
            - PySocks >= 1.5.6
          use:ssl:
            - cryptography >= 1.3.4
            - pyopenssl >= 0.14
        revision:
          2.28.1: 1
        body: |
          # FL-7939, FL-10662: relax deps for idna, charset_normalizer: requests sets "cautionary upper masks" which can break:
          src_prepare() {
            sed -i -e 's/idna.*/idna/' -e 's/charset_normalizer.*/charset_normalizer/' setup.cfg || die
            sed -i -e 's/"idna.*$/"idna",/' -e 's/"charset_normalizer.*$/"charset_normalizer",/' setup.py || die
            distutils-r1_src_prepare
          }
    - urllib3:
        version: 1.26.15
        python_compat: python2+ pypy3
        revision:
          '1.26.15': '2'
        # https://github.com/urllib3/urllib3/issues/2680
        pydeps:
          py:all:build:
            - setuptools
        rdepend: |
          !>=dev-python/urllib3-2
          !dev-python/urllib3-compat

simple_python_autogen_rule:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-compat-1
  packages:
    - asciinema:
        cat: app-misc
        homepage: https://asciinema.org/ https://pypi.org/project/asciinema/
        license: GPL-3+
        python_compat: python3+
        body: |
          python_prepare_all() {
            distutils-r1_python_prepare_all
            sed -i -e "s|data_files=\[('share/doc/asciinema|&-${PVR}|" setup.py || die
          }
    - astor:
        homepage: https://pypi.org/project/astor/
        license: BSD
        python_compat: python2+ pypy
        pydeps:
          py:all:
            - dev-python/setuptools
        body: |
          python_prepare_all() {
            #avoid file collisions picked up by the eclass
            sed -e s":find_packages():find_packages(exclude=['tests']):" -i setup.py || die
            distutils-r1_python_prepare_all
          }
          python_test() {
            "${PYTHON}" -m unittest discover || die "tests failed under ${EPYTHON}"
          }
    - astroid:
        desc: Abstract Syntax Tree for logilab packages
        license: LGPL-2.1
        iuse: test
        pydeps:
          py:all:
            - lazy-object-proxy
            - six
            - typed-ast
            - wrapt
          use:test:
            - nose
            - numpy
            - pytest
            - python-dateutil
    - atomicwrites:
        homepage: https://github.com/untitaker/python-atomicwrites
        license: MIT
        python_compat: python2+ pypy3
    - attrs:
        revision:
          23.1.0: 1
        du_pep517: hatchling
        pydeps:
          py:all:build:
            - hatch-vcs
            - hatch-fancy-pypi-readme
    - hatch-fancy-pypi-readme:
        pypi_name: hatch_fancy_pypi_readme
        du_pep517: hatchling
        pydeps:
          py:all:
            - tomli
          py:3.7:
            - typing-extensions
    - beautifulsoup:
        du_pep517: hatchling
        pypi_name: beautifulsoup4
        desc: Pythonic idioms for iterating, searching, and modifying an HTML/XML parse tree
        homepage: https://www.crummy.com/software/BeautifulSoup/bs4/
        license: MIT
        python_compat: python3+ pypy3
        pydeps:
          py:all:
            - soupsieve
            - lxml
        rdepend: |
          !dev-python/beautifulsoup:4
    - booleanOperations:
        desc: Boolean operations on paths
        homepage: https://github.com/typemytype/booleanOperations
        license: MIT
        pydeps:
          py:all:
            - fonttools
            - pyclipper
            - wheel
    - bpytop:
        desc: Linux/OSX/FreeBSD resource monitor
        homepage: https://github.com/aristocratos/bpytop
        license: Apache-2.0
        cat: sys-process
        pydeps:
          - psutil
        body: |
          src_install() {
            insinto "/usr/share/${PN}/themes"
            doins themes/*.theme
            distutils-r1_src_install
          }
    - brotlicffi:
        python_compat: python3+ pypy3
        restrict: test
        rdepend: |
          >=app-arch/brotli-1.0.9
        body: |
          src_configure() {
            export USE_SHARED_BROTLI=1
          }
    - cairocffi:
        desc: CFFI based drop in replacement for Pycairo
        homepage: https://github.com/Kozea/cairocffi
        license: BSD
        restrict: test
        du_pep517: flit
        revision:
          1.6.0 : 1
        pydeps:
          py:'python*':
            - cffi >= 1.1.0:=
          py:all:
            - xcffib >= 0.3.2
        rdepend: |
          x11-libs/cairo:0=[X,xcb(+)]
          x11-libs/gdk-pixbuf[jpeg]
    - charset_normalizer:
        desc: The Real First Universal Charset Detector
        homepage: https://github.com/ousret/charset_normalizer
        license: MIT
        body: |
          src_prepare() {
            sed -i -e '/addopts/d' setup.cfg || die
            distutils-r1_src_prepare
          }
    - cheetah3:
        pypi_name: Cheetah3
        desc: Python-powered template engine and code generator
        homepage: http://www.cheetahtemplate.org/ https://pypi.org/project/Cheetah3/
        license: MIT
        du_setuptools: 'no'
        restrict: test
        rdepend: "!dev-python/cheetah"
        pydeps:
          - markdown
    - click-log:
        homepage: https://github.com/click-contrib/click-log https://pypi.org/project/click-log/
        pydeps:
          - click
        body: |
          DOCS=( README.rst )
    - click-threading:
        homepage: https://github.com/click-contrib/click-threading https://pypi.org/project/click-threading/
        license: MIT
        pydeps:
          - click
        body: |
          DOCS=( README.rst )
    - configobj:
        desc: Simple config file reader and writer
        homepage: http://www.voidspace.org.uk/python/configobj.html https://pypi.org/project/configobj/
        license: BSD
        pydeps:
          - six
    - dict-toolbox:
        homepage: https://gitlab.com/saltstack/open/dict-toolbox https://pypi.org/project/dict-toolbox/
        license: Apache-2.0
        pydeps:
          - aiofiles
          - msgpack
          - pyyaml
        body: |
          src_prepare() {
            install -d ${S}/requirements
            touch ${S}/requirements/base.txt || die
            default
          }
    - defcon:
        desc: A set of UFO based objects for use in font editing applications
        homepage: https://github.com/robotools/defcon
        license: MIT
        pydeps:
          py:all:build:
            - fonttools
          py:all:
            - setuptools_scm
    - extras:
        revision:
          1.0.0: 1
        python_compat: python2+ pypy pypy3
        pydeps:
          py:all:build:
            - setuptools
            # Due to unfortunate setup.py, there is a hard dep on testtools.
            - testtools >= 2.5.0-r1
    - eyeD3:
        python_compat: python3+ pypy3
        desc: Python tool for working with audio files, specifically MP3 files containing ID3 metadata
        license: GPL-3
        pydeps:
          py:all:
            - deprecation
            - filetype
    - fetchcord:
        cat: net-im
        pypi_name: FetchCord
        desc: FetchCord grabs your OS info and displays it as Discord Rich Presence
        homepage: https://github.com/MrPotatoBobx/FetchCord
        license: MIT
        pydeps:
          py:all:
            - psutil
            - pypresence
        depend: |
          net-im/discord-bin
          app-misc/neofetch
          x11-apps/mesa-progs
        python_compat: python3+
    - filetype:
        desc: Infer file type and MIME type checking the magic numbers signature of a file or buffer.
        license: MIT
        python_compat: python3+
    - fonttools:
        desc: Library for manipulating TrueType, OpenType, AFM and Type1 fonts
        homepage: https://github.com/fonttools/fonttools/
        license: BSD
        python_compat: python3+
        pydeps:
          py:all:build:
            - cython
          py:all:
            - fs
        body: |
          src_configure() {
            DISTUTILS_ARGS=( --with-cython )
          }
    - fs:
        desc: Filesystem abstraction layer
        homepage: https://pypi.org/project/fs/ https://docs.pyfilesystem.org https://www.willmcgugan.com/tag/fs/
        license: MIT
        python_compat: python3+
        pydeps:
          py:all:
            - appdirs
            - pytz
            - six
        body: |
          pkg_postinst() {
            echo "S3 support dev-python/boto"
            echo "SFTP support dev-python/paramiko"
            echo "Browser support dev-python/wxpython"
          }
    - gi-docgen:
        cat: dev-util
        desc: A documentation generator for GObject-based libraries
        homepage: https://gitlab.gnome.org/GNOME/gi-docgen
        license: "|| ( Apache-2.0 GPL-3+ ) CC0-1.0 OFL-1.1 MIT GPL-3+ LGPL-2 MIT MPL-1.1 CC-By-SA-3"
        python_compat: python3+
        pydeps:
          - markdown
          - typogrify
          - jinja
    - khal:
        cat: app-misc
        desc: A CalDAV based calendar
        homepage: http://lostpackets.de/khal/
        license: MIT
        iuse: zsh-completion
        rdepend:
          zsh-completion? ( app-shells/zsh )
        pydeps:
          py:all:build:
            - setuptools_scm
          py:all:
            - atomicwrites
            - click-log
            - click
            - configobj
            - freezegun
            - icalendar
            - python-dateutil
            - pytz
            - pyxdg
            - setproctitle
            - setuptools_scm
            - tzlocal
            - urwid
            - vdirsyncer
        body: |
          DOCS=( AUTHORS.txt CHANGELOG.rst CONTRIBUTING.rst README.rst khal.conf.sample )
          src_install() {
            distutils-r1_src_install
            if use zsh-completion; then
              insinto /usr/share/zsh/site-functions
              doins misc/__khal
            fi
          }
    - lazy-object-proxy:
        desc: A fast and thorough lazy object proxy
        homepage:  https://github.com/ionelmc/python-lazy-object-proxy https://python-lazy-object-proxy.readthedocs.org https://pypi.org/project/lazy-object-proxy/
        license: BSD
        iuse: test
        pydeps:
          py:build:all:
            - setuptools
          use:test:
            - pytest
    - mccabe:
        python_compat: python2+
        desc: "flake8 plugin: McCabe complexity checker"
        homepage: https://github.com/PyCQA/mccabe
        license: MIT
        pydeps:
          py:all:runtime:
            - flake8
        body: |
          python_prepare_all() {
            sed -i -e '/pytest-runner/d' setup.py || die
            distutils-r1_python_prepare_all
          }
    - nototools:
        pypi_name: notofonttools
        desc: Noto fonts support tools and scripts plus web site generation
        homepage: https://github.com/googlefonts/nototools
        license: Apache-2.0 OFL-1.1
        pydeps:
          py:all:
            - booleanOperations
            - defcon
            - fonttools
            - pillow
            - pyclipper
        rdepend: |
          media-gfx/scour
    - nyx:
        cat: net-misc
        python_compat: python3+
        desc: Utility to monitor real time Tor status information
        homepage: https://nyx.torproject.org
        license: GPL-3
        pydeps:
          py:all:
            - net-libs/stem
        rdepend: |
          net-vpn/tor
    - paramiko:
        compat: 2.9.5
        blocker: "!<=dev-python/paramiko-3.2.0"
        revision:
          3.2.0: 1
        license: LGPL-2.1
        restrict: test
        pydeps:
          - bcrypt >= 3.1.3
          - cryptography >= 2.5
          - pynacl >= 1.0.1
          - pyasn1 >= 0.1.7
          - six
    - patch-ng
    - pycodestyle:
        compat: '2.8.0'
        blocker: '!<dev-python/pycodestyle-2.11.0-r1'
        revision:
          2.11.0: 1
    - pyflakes:
        python_compat: python2+
        desc: Passive checker for Python programs
        homepage: |
          https://github.com/PyCQA/pyflakes
          https://pypi.org/project/pyflakes/
        license: MIT
    - pysol_cards:
        python_compat: python3+
        desc: Deal PySol FreeCell cards
        homepage: |
          https://github.com/shlomif/pysol_cards/
          https://pypi.org/project/pysol-cards/
        license: MIT
        pydeps:
          py:all:
            - random2
            - six
    - pylint:
        desc: Python code static checker
        license: GPL-2
        iuse: doc test
        pydeps:
          py:build:all:
            - setuptools
          py:all:
            - astroid
            - isort
            - mccabe
            - tomlkit
          use:doc:
            - sphinx
          use:test:
            - pytest
    - python-pam:
        desc: Python3 module for PAM authentication
        homepage: https://github.com/FirefighterBlu3/python-pam
        license: MIT
        python_compat: python3+
    - pytz:
        python_compat: python2+
        pydeps:
          - setuptools
        rdepend: |
          sys-libs/timezone-data
        depend: |
          sys-libs/timezone-data
          app-arch/unzip
        body: |
          src_prepare() {
              default
              # configure the source code to grab zoneinfo files from /usr/share/zoneinfo by default:
              sed -i -e "/zoneinfo_dir = os.environ.get/s:None:'/usr/share/zoneinfo':" $S/pytz/__init__.py || die
          }
          post_src_install() {
              # Remove all bundled zoneinfo data:
              find "$D" -type d -name zoneinfo -exec rm -rf {} \; 2>/dev/null
          }
    - psutil:
        desc: Retrieve information on running processes and system utilization
        python_compat: python2+ pypy{,3}
        revision:
          "5.9.5": "1"
        body: |
          python_compile() {
            # Force -j1 to avoid .o linking race conditions
            local MAKEOPTS=-j1
            distutils-r1_python_compile
          }
    - setuptools_scm_git_archive:
        python_compat: python3+
        pydeps:
          py:all:build:
            - setuptools_scm
    - soupsieve:
        desc: A modern CSS selector implementation for BeautifulSoup
        homepage: https://github.com/facelessuser/soupsieve/ https://pypi.org/project/soupsieve/
        license: MIT
        python_compat: python3+ pypy3
        # 2.3.2 and up use pyproject.toml which doesn't work yet on Funtoo
        version: 2.3.1
    - jeepney:
        python_compat: python3+
        py:all:build:
          - setuptools
    - tqdm:
        python_compat: python2+
        pydeps:
          py:all:build:
            - setuptools
            - setuptools_scm
    - typogrify:
        python_compat: python3+
        homepage: https://github.com/mintchaos/typogrify/
        desc: Filters for web typography, supporting Django & Jinja templates
        license: BSD
        pydeps:
          - smartypants
    - ufoLib:
        pypi_name: ufoLib2
        desc: A UFO font library
        homepage: https://github.com/fonttools/ufoLib2
        license: Apache-2.0
        python_compat: python3+
        pydeps:
          py:all:
            - attrs
            - fonttools
            - fs
            - lxml
        bdepend: |
          app-arch/unzip
        body: |
          python_prepare_all() {
            sed -e '/\<wheel\>/d' -i setup.cfg || die
            distutils-r1_python_prepare_all
          }
    - hg-git:
        cat: dev-vcs
        homepage: https://hg-git.github.io  https://pypi.org/project/hg-git/
        license: GPL-2
        depend: ${RDEPEND}
        pydeps:
          - dev-vcs/mercurial >= 4.3
          - dulwich >= 0.19.0
    - icalendar:
        desc: Package used for parsing and generating iCalendar files (RFC 2445)
        homepage: https://github.com/collective/icalendar
        license: BSD
        pydeps:
          - python-dateutil
          - pytz
        body: |
          distutils_enable_sphinx docs
          python_prepare_all() {
            # reset conf.py to not read version from an installed instance
            sed -e "s:pkg_resources.get_distribution('icalendar').version:'${PV}':" \
              -i docs/conf.py || die
            distutils-r1_python_prepare_all
          }
    - m2crypto:
        pypi_name: M2Crypto
        python_compat: python3+ pypy3
        inherit:
          - toolchain-funcs
        desc: A Python crypto and SSL toolkit
        homepage: https://gitlab.com/m2crypto/m2crypto https://pypi.org/project/M2Crypto/
        license: MIT
        iuse: libressl
        rdepend: |
          libressl? ( dev-libs/libressl:0= )
          !libressl? ( dev-libs/openssl:0= )
          virtual/python-typing[$PYTHON_USEDEP]
        bdepend: |
          >=dev-lang/swig-2.0.9
        body: |
          swig_define() {
            local x
            for x; do
              if tc-cpp-is-true "defined(${x})"; then
                SWIG_FEATURES+=" -D${x}"
              fi
            done
          }
          python_compile() {
            # setup.py looks at platform.machine() to determine swig options.
            # For exotic ABIs, we need to give swig a hint.
            local -x SWIG_FEATURES=

            # https://bugs.gentoo.org/617946
            swig_define __ILP32__

            # https://bugs.gentoo.org/674112
            swig_define __ARM_PCS_VFP

            distutils-r1_python_compile
          }
          python_test() {
            esetup.py test
          }
    - pypeg2:
        pypi_name: pyPEG2
        du_setuptools: 'no'
        homepage: https://pypi.org/project/pyPEG2/ https://fdik.org/pyPEG/
        license: GPL-2
        restrict: test
        pydeps:
          - lxml
    - pypresence:
        desc: A Discord RPC library in Python
        homepage: https://qwertyquerty.github.io/pypresence/html/index.html
        license: MIT
        du_setuptools: rdepend
        python_compat: python3+
    - requests-toolbelt:
        homepage: https://toolbelt.readthedocs.org/
        license: Apache-2.0
        pydeps:
          - requests
        body: |
          DOCS=( AUTHORS.rst HISTORY.rst README.rst )
    - semantic_version:
        desc: Python library providing a few tools handling SemVer in Python
        homepage: https://pypi.org/project/semantic_version/
        license: BSD
    - speedtest-cli:
        cat: net-analyzer
        homepage: https://github.com/sivel/speedtest-cli
        license: Apache-2.0
        du_setuptools: rdepend
    - thefuck:
        cat: app-shells
        homepage: https://github.com/nvbn/thefuck
        license: MIT
        pydeps:
          py:all:
            - psutil
            - six
            - decorator
            - colorama
            - pyte
        python_compat: python3+
        body: |
          python_prepare_all() {
            sed -i -e "/import pip/s/^/#/" -e "/pip.__version__/,+3 s/^/#/" setup.py || die
            distutils-r1_python_prepare_all
          }
    - tzlocal:
        homepage: https://github.com/regebro/tzlocal
        license: MIT
        pydeps:
          - pytz
    - iniparse:
        desc: Better INI parser for Python
        homepage: https://pypi.org/project/iniparse
        license: MIT PSF-2
        python_compat: python2+
        pydeps:
          py:all:
            - six >= 1.10.0
    - translate-toolkit:
        desc: Toolkit to convert between many translation formats
        homepage: https://github.com/translate/translate
        license: GPL-2
        du_setuptools: 'rdepend'
        iuse: +html +ical +ini +subtitles +yaml
        restrict: test
        pydeps:
          py:all:
            - six >= 1.11.0
            - chardet >= 3.0.4
            - cheroot
            - lxml >= 4.3.1
            - pycountry >= 19.8.18
            - python-levenshtein >= 0.12.0
            - ruamel-yaml
          use:html:
            - utidylib
          use:ical:
            - vobject
          use:ini:
            - iniparse >= 0.5
          use:yaml:
            - pyyaml
          use:subtitles:
            - media-video/gaupol
        rdepend: |
          !dev-python/pydiff
          app-text/iso-codes
          sys-devel/gettext
        body: |
          distutils_enable_sphinx docs dev-python/sphinx-bootstrap-theme
          src_prepare() {
            sed -i -e 's#"docs", "share"#"share"#' setup.py
            distutils-r1_src_prepare
          }

          python_install_all() {
            distutils-r1_python_install_all

            if ! use html; then
              rm "${ED}"/usr/bin/{html2po,po2html} || die
            fi
            if ! use ical; then
              rm "${ED}"/usr/bin/{ical2po,po2ical} || die
            fi
            if ! use ini; then
              rm "${ED}"/usr/bin/{ini2po,po2ini} || die
            fi
            if ! use subtitles; then
              rm "${ED}"/usr/bin/{sub2po,po2sub} || die
            fi
            python_optimize
          }
    - urwid:
        desc: Curses-based user interface library for Python
        homepage: http://urwid.org/ https://pypi.org/project/urwid/ https://github.com/urwid/urwid/
        license: LGPL-2.1
        iuse: examples
        body: |
          distutils_enable_sphinx docs
          python_install_all() {
            use examples && dodoc -r examples
            distutils-r1_python_install_all
          }
    - vdirsyncer:
        homepage: https://github.com/pimutils/vdirsyncer
        license: BSD
        pydeps:
          - click
          - click-log
          - click-threading
          - requests
          - requests-toolbelt
          - atomicwrites
        body: |
          DOCS=( AUTHORS.rst CHANGELOG.rst CONTRIBUTING.rst README.rst config.example )
    - xcffib:
        homepage: https://github.com/tych0/xcffib
        license: Apache-2.0
        restrict: test
        pydeps:
          py:'python*':
            - cffi >= 1.1:=
          py:all:
            - six
        depend: |
          x11-libs/libxcb
    - yq:
        cat: app-misc
        homepage: https://yq.readthedocs.io/ https://github.com/kislyuk/yq/ https://pypi.org/project/yq/
        license: Apache-2.0
        pydeps:
          py:all:
            - dev-python/argcomplete
            - dev-python/pyyaml
            - dev-python/setuptools
            - dev-python/xmltodict
        rdepend: |
          app-misc/jq

misc:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-simple-1
  packages:
    - colored:
        license: MIT
        python_compat: python2+
    - distro:
        license: Apache-2.0

metatools:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-simple-1
  packages:
    - h11
    - httpcore:
        du_pep517: generator
        pydeps:
          - h11
          - sniffio
          - anyio
          - certifi
          - h2
    - h2:
        pydeps:
          - hpack
          - hyperframe
    - hpack
    - hyperframe
    - httpx:
        du_pep517: hatchling
        pydeps:
          py:all:build:
            - hatch-fancy-pypi-readme
          py:all:
          - certifi
          - httpcore
          - sniffio
          - idna
          - h2
    - rich:
        pydeps:
          - pygments
          - markdown-it-py
    - markdown-it-py:
        pydeps:
          - mdurl
    - mdurl
    - sniffio:
        license: '|| ( Apache-2.0 MIT )'

io_stuff_rule:
  generator: pypi-simple-1
  defaults:
    cat: dev-python
    python_compat: python3+
  packages:
    - anyio:
        pydeps:
          - sniffio >= 1.1
          - idna >= 2.8
          - typing-extensions
          - curio >= 1.4
          - trio >= 0.16
        revision:
          3.5.0: 1
    - async-generator:
        license: '|| ( Apache-2.0 MIT )'
        pypi_name: async_generator
    - exceptiongroup:
        du_pep517: flit_scm
    - trio:
        revision:
          0.22.1: 1
        license: '|| ( Apache-2.0 MIT )'
        pydeps:
          - attrs >= 20.1.0
          - sortedcontainers
          - async-generator >= 1.9
          - idna
          - outcome
          - sniffio
          - exceptiongroup
    - sortedcontainers:
        license: Apache-2.0
        python_compat: python2+
    - outcome:
        license: '|| ( Apache-2.0 MIT )'
        pydeps:
          - attrs >= 19.2.0
    - uvloop
    - curio

gis_rule:
  generator: pypi-simple-1
  defaults:
    cat: dev-python
    python_compat: python3+
  packages:
    - pyproj:
        license: MIT
        desc: Python interface to the PROJ library
        pydeps:
          py:all:build:
            - cython
        rdepend: |
          >=sci-libs/proj-6.2.0:=
        body: |
          distutils_enable_sphinx docs dev-python/sphinx_rtd_theme

# Stuff that has moved on to python3 but that we need compat ebuilds for ---
# for compatibility.
#
compat_testing_deps_rule:
  defaults:
    cat: dev-python
    python_compat: python3+ pypy3
  generator: pypi-compat-1
  packages:
    - pytest:
        body: |
          post_src_install() {
            if [ "$PV" == "4.6.9" ]; then
              rm -rf ${D}/usr/bin
            fi
          }
        compat: '4.6.9'
        blocker: '!<dev-python/pytest-6.1.1'
        pydeps:
          py:all:build:
            - setuptools_scm
          py:all:
            - attrs >= 19.2.0
            - iniconfig
            - packaging
            - pluggy >= 0.12
            - pluggy < 2
            - py >= 1.8.2
            - toml
          py:2:
            - atomicwrites
            - pathlib2
            - funcsigs
            - wcwidth
            - six
          py:2,3.6,3.7,pypy3:
            - importlib_metadata
    - mock:
        desc: 'Stand-alone version of unittest.mock included in py3.3+'
        compat: '3.0.5'
        blocker: '!<dev-python/mock-3.0.5'
        homepage: 'https://github.com/testing-cabal/mock'
        license: BSD
        pydeps:
          py:2:
            - funcsigs
          py:all:
            - six >= 1.9
    - fixtures:
        compat: 3.0.0
        blocker: '!<dev-python/fixtures-4.0.1-r1'
        revision:
          4.0.1: 1
        pydeps:
          - pbr
          - six
          - testtools

testing_deps_rule:
  defaults:
    cat: dev-python
    python_compat: python3+
    du_pep517: generator
  generator: pypi-compat-1
  packages:
    - iniconfig:
        compat: 1.1.1
        blocker: '!<=dev-python/iniconfig-2.0.0'
        revision:
          2.0.0: 1
        du_pep517: hatchling
        license: MIT
        python_compat: python2+ pypy3
        pydeps:
          py:all:build:
            - setuptools_scm
            - hatch-vcs
        body: |
          src_prepare() {
            # fix license in pyproject.toml
            sed -i -e 's/license = "MIT"/license = { text = "MIT" }/g' pyproject.toml || die

            distutils-r1_src_prepare
          }
    - pluggy:
        compat: 0.9.0
        blocker: '!<=dev-python/pluggy-1.0.0'
        revision:
          1.0.0: 1
        version:
          latest:
            keywords: next
          '1.2.0':
            keywords: '*'
        license: MIT
        python_compat: python2+ pypy3
        pydeps:
          py:3.7:
            - importlib_metadata
    - setuptools-declarative-requirements:
        license: Apache-2.0
        pydeps:
          - setuptools_scm
        body: |
          # https://github.com/s0undt3ch/setuptools-declarative-requirements/pull/3
          src_prepare() {
            rm ${S}/tests/__init__.py || die
            default
          }
    - pytest-asyncio:
        license: Apache-2.0
        pydeps:
          - pytest
    - pytest-tempdir:
        license: Apache-2.0
        python_compat: python2+
        pydeps:
          - pytest >= 2.8.1
    # required by pytest-pop:
    - asynctest:
        license: Apache-2.0

dev_python_simplified_rule:
  defaults:
    cat: dev-python
    python_compat: python3+
    du_pep517: generator
  generator: pypi-compat-1
  packages:
    - async-property:
        license: MIT
        pypi_name: async_property
        pydeps:
          py:all:
            - pytest-runner
    - colorama:
        python_compat: python2+ pypy3
        desc: ANSI escape character sequences for colored terminal text & cursor positioning
        homepage: https://github.com/tartley/colorama https://pypi.org/project/colorama/
        license: BSD
        compat: 0.4.4
        blocker: "!<dev-python/colorama-0.4.6-r1"
        revision:
          0.4.6: 1
    - cppy:
        revision:
          1.2.1: 1
    - dbus-next:
        pypi_name: dbus_next
    - pymongo:
        du_pep517: hatchling
        revision:
          4.0: 1
          4.8.0: 1
        python_compat: python2+
        compat: '3.12.1'
        blocker: "!<dev-python/pymongo-4.0" #block all older versions
        iuse: kerberos
        pydeps:
          py:all:
            - hatch-requirements-txt
          use:kerberos:
            - pykerberos
    - pygments:
        compat: 2.5.2
        blocker: '!<dev-python/pygments-2.17.0-r1'
        revision:
          2.17.0: 1

    - pykerberos:
        depend: "app-crypt/mit-krb5"
        rdepend: '${DEPEND}'
        du_pep517: setuptools
        pydeps:
          py:all:build:
            - setuptools

    - m2r:
        python_compat: python3+ pypy
        compat: '0.2.1'
        revision:
          0.2.1: 1
        blocker: "!<=dev-python/m2r-0.2.1"
        pydeps:
          py:all:build:
            - setuptools
          py:all:runtime:
            - mistune
            - docutils
        body: |
          python_prepare_all() {
            sed -e "s/packages=\['tests'\],/packages=[],/" -i setup.py
            distutils-r1_python_prepare_all
          }

    - motor:
        rdepend: |
          !<dev-python/pymongo-4.1
        pydeps:
          py:all:
            - pymongo >= 4.1
    - pyparsing:
        version: '2.4.7'
        python_compat: python2+
# See FL-9027:
#        compat: '2.4.7'
#        blocker: "!<dev-python/pyparsing-3.0.0"
#        python_compat: python2+
    - prometheus_client:
        compat: 0.12.0
        pydeps:
          py:all:
            - twisted
    - ovs:
        pydeps:
          py:all:
            - dev-python/sortedcontainers
    - rfc3986:
        compat: '1.5.0'
        revision:
          2.0.0: 1
        blocker: "!<dev-python/rfc3986-2"
        desc: A Python implementation of RFC 3986 including validation and authority parsing
        homepage: http://rfc3986.readthedocs.io/ https://pypi.org/project/rfc3986/
        license: Apache-2.0
        python_compat: python2+ pypy{,3}
    - setuptools_scm:
        revision:
          7.0.2: 2
        compat: '5.0.2'
        blocker: "!<=dev-python/setuptools_scm-7.0.2"
        python_compat: python3+
        pdepend: |
          dev-python/importlib_metadata[${PYTHON_USEDEP}]
        version:
          7.1.0:
            patches:
              - setuptools_scm-7.0.2-importlib-metadata.patch
        pydeps:
          py:all:build:
            - packaging > 20
          py:3:build:
            - tomli >= 1.0
          py:3:
            - tomli >= 1.0
          py:2:build:
            - toml
    - setuptools-rust:
        pydeps:
          py:all:
            - wheel
            - semantic_version >= 2.8.5
            - toml
            - typing-extensions
    - cryptography:
        compat: '3.3.2'
        revision:
          '40.0.2': '1'
        blocker: "!<dev-python/cryptography-3.4.2"
        inherit:
          - cargo
        cargo_optional: yes
        cargo_path: src/rust
        iuse: cpu_flags_x86_sse2 libressl idna
        license: "|| ( Apache-2.0 BSD )"
        desc: Library providing cryptographic recipes and primitives
        depend: |
          libressl? ( dev-libs/libressl:0= )
          !libressl? ( dev-libs/openssl:0= )
          !x86? ( >=virtual/rust-1.37.0 )
          x86? (
            cpu_flags_x86_sse2? (
              >=virtual/rust-1.37.0
            )
          )
        pydeps:
          py:3:build:
            - setuptools-rust >= 0.12.1
            - cffi >= 1.11.3
          py:all:
            - six >= 1.4.1
            - virtual/python-enum34
            - virtual/python-ipaddress
            - cffi >= 1.11.3
          use:idna:
            - idna >= 2.1
        body: |
          pkg_setup() {
            use x86 && ! use cpu_flags_x86_sse2 && export CRYPTOGRAPHY_DONT_BUILD_RUST=1
          }
          src_unpack() {
            if [[ ${CRYPTOGRAPHY_DONT_BUILD_RUST} ]] || [ "$PN"  == 'cryptography-compat' ] ; then
              default
            else
              cargo_src_unpack
            fi
          }
    - itsdangerous:
        revision:
          2.0.1: 1
        compat: 1.1.0
        blocker: '!<dev-python/itsdangerous-2.0.1'
        desc: Various helpers to pass trusted data to untrusted environments and back
        license: BSD
    - jinja:
        compat: 2.11.3
        blocker: '!<dev-python/jinja-3.0.0'
        pypi_name: jinja2
        desc: A full-featured template engine for Python
        homepage: https://palletsprojects.com/p/jinja/ https://pypi.org/project/Jinja2/
        license: BSD
        iuse: examples
        restrict: test
        rdepend: '!dev-python/jinja:compat'
        pydeps:
          - markupsafe
        body: |
          distutils_enable_sphinx docs \
            dev-python/sphinx-issues \
            dev-python/pallets-sphinx-themes
          src_prepare() {
            # avoid unnecessary dep on extra sphinxcontrib modules
            sed -i '/sphinxcontrib.log_cabinet/ d' docs/conf.py || die
            distutils-r1_src_prepare
          }
          python_install_all() {
            if use examples ; then
              docinto examples
              dodoc -r examples/.
            fi
            distutils-r1_python_install_all
          }
          pkg_postinst() {
            if ! has_version dev-python/Babel; then
              elog "For i18n support, please emerge dev-python/Babel."
            fi
          }
    - j2cli:
        pydeps:
          - jinja
          - pyyaml
    - markupsafe:
        compat: 1.1.1
        blocker: '!<dev-python/markupsafe-2.0.0'
        pypi_name: MarkupSafe
        desc: Implements a XML/HTML/XHTML Markup safe string for Python
        homepage: https://pypi.org/project/MarkupSafe
        license: BSD
    - mypy:
        pydeps:
          py:all:
            - psutil
            - mypy_extensions >= 0.4.3
            - tomli
          py:3.7:
            - typed-ast >= 1.4.0
    - mypy_extensions
    - sentry-sdk:
        pydeps:
          - urllib3
          - certifi
    - shapely:
        depend: ">=sci-libs/geos-3.5"
        pydeps:
          py:all:
            - numpy
          py:all:build:
            - cython
    - trimesh:
        rdepend: |
          sci-libs/scipy
          dev-libs/xxhash
        pydeps:
          - chardet
          - colorlog
          - jsonschema
          - lxml
          - msgpack
          - networkx
          - numpy
          - pillow
          - pycollada
          - pyglet
          - requests
          - rtree
          - shapely
          - svg-path
          - sympy
    - pycollada:
        pydeps:
          - lxml
          - numpy
          - python-dateutil >= 2.2
    - rtree:
        pypi_name: Rtree
    - svg-path:
        pypi_name: svg.path
    - typed-ast:
        pypi_name: typed_ast
    - pydot:
        rdepend: "media-gfx/graphviz"
        pydeps:
          - pyparsing >= 2.1.4
    - gmpy:
        pypi_name: gmpy2
        depend: |
          dev-libs/mpc:=
          dev-libs/mpfr:=
          dev-libs/gmp:=
    - pythran:
        pydeps:
          - beniget
          - numpy
          - gast
          - ply
    - beniget:
        pydeps:
          - gast
    - gast
    - networkx:
        compat: '2.2'
        blocker: '!<=dev-python/networkx-2.2'
        version: 2.6.3
    - keyring:
        pydeps:
          py:all:
            - secretstorage
            - entrypoints
            - jeepney
            - importlib_metadata
          py:all:build:
            - setuptools_scm
            - toml

better_autogens_without_templates:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-simple-1
  packages:
    - cython:
        pypi_name: Cython
        version: 0.29.36
        python_compat: python2+
    - py:
        python_compat: python2+ pypy{,3}
        revision:
          1.11.0: 1
        pydeps:
          py:all:build:
            - setuptools
            - setuptools_scm

sphinx_and_friends:
  defaults:
    cat: dev-python
    python_compat: python3+ pypy
  generator: pypi-compat-1
  packages:
    - alabaster:
        du_pep517: flit
        compat: 0.7.9
        revision:
          0.7.13: 1
          0.7.16: 1
        blocker: '!<=dev-python/alabaster-0.7.13'
    - sphinx:
        du_pep517: flit
        iuse: latex doc
        rdepend: |
          latex? (
            dev-texlive/texlive-latexextra
            dev-texlive/texlive-luatex
            app-text/dvipng
          )
        pydeps:
          py:all:build:
            - setuptools
          py:all:
            - alabaster < 0.8
            - Babel
            - docutils
            - imagesize
            - jinja
            - pygments
            - requests
            - snowballstemmer
            - packaging
            - importlib_metadata >= 4.4
            # Sphinx is weird and truly RDEPENDs on another namespace of sphinxcontrib packages to work:
            - sphinxcontrib-applehelp
            - sphinxcontrib-devhelp
            - sphinxcontrib-htmlhelp
            - sphinxcontrib-jsmath
            - sphinxcontrib-qthelp
            - sphinxcontrib-serializinghtml
        body: |
          python_compile_all() {
            if use doc; then
              esetup.py build_sphinx
              HTML_DOCS=( "${BUILD_DIR}"/sphinx/html/. )
            fi
          }
    - sphinx_rtd_theme:
        pydeps:
          - sphinxcontrib-jquery
          - sphinx
          - docutils

sphinx_contrib:
  generator: pypi-compat-1
  defaults:
    cat: dev-python
    python_compat: python3+ pypy
    du_pep517: generator
    pydeps:
        py:all:
          - namespace-sphinxcontrib
  packages:
    - sphinxcontrib-applehelp
    - sphinxcontrib-devhelp
    - sphinxcontrib-htmlhelp
    - sphinxcontrib-jsmath
    - sphinxcontrib-qthelp
    - sphinxcontrib-serializinghtml
    - sphinxcontrib-jquery


pep517_compliance_rule:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-compat-1
  packages:
    - flit_core:
        du_pep517: standalone
        desc: Simplified packaging of Python modules (core module)
    - sip:
        version: 6.8.3
        du_pep517: generator
        license: SIP
        pydeps:
          - packaging
          - toml
    - pep517:
        du_pep517: flit
        pydeps:
          py:all:
            - tomli
          py:all:build:
            - flit_core
    - build:
        pydeps:
          - packaging >= 19.0
          - pep517 >= 0.9.1
          - tomli >= 1.0.0
    - flit_scm:
        du_pep517: standalone
        pydeps:
          - flit_core
          - setuptools_scm
          - tomli
    - hatchling:
        du_pep517: standalone
        rdepend: '${DEPEND}'
        version:
          latest:
            keywords: next
          '1.17.1':
            keywords: '*'
        pydeps:
          py:all:
            - editables
            - tomli
          py:3.7:build:
            - pluggy <= 1.2.0
          py:all:build:
            - pathspec
            - packaging
            - pluggy
            - installer
            - trove-classifiers
    - hatch-requirements-txt:
        du_pep517: hatchling
    - trove-classifiers:
        pydeps:
          py:all:build:
            - calver
    - calver
    - hatch-vcs:
        pypi_name: hatch_vcs
        du_pep517: hatchling
        pydeps:
          - setuptools_scm
    - editables
    - pathspec
    - jupyter_packaging:
        du_pep517: hatchling
        pydeps:
          - deprecation
          - packaging
          - setuptools
          - tomlkit
          - wheel
    - deprecation:
        pydeps:
          - packaging
    - tomlkit
    - meson-python:
        du_pep517: standalone
        rdepend: 'dev-util/patchelf'
        pydeps:
          - meson
          - pyproject-metadata
          - tomli
    - pyproject-metadata:
        pydeps:
          - packaging
    - pdm-pep517:
        du_pep517: standalone
        pydeps:
          - packaging
          - cerberus
          - license-expression
          - tomli
          - tomli-w
          - setuptools
    - cerberus:
        pypi_name: Cerberus
    - license-expression:
        pydeps:
          py:all:
            - boolean-py
          py:all:build:
            - setuptools_scm
    - tomli-w:
        du_pep517: flit
    - boolean-py:
        pypi_name: boolean.py
    - poetry-core:
        version:
          latest:
            # py3.8+
            keywords: next
          '1.6.1':
            # py3.7
            keywords: '*'
        du_pep517: standalone
        pydeps:
          - attrs
          - jsonschema
          - lark
          - packaging
          - pyparsing
          - pyrsistent
          - six
          - tomlkit
    - python-dotenv:
        du_pep517: setuptools
        body: |
          DOCS=( CHANGELOG.md README.md )
          python_install() {
            distutils-r1_python_install
            ln -s dotenv "${D}$(python_get_scriptdir)"/python-dotenv || die
          }
          src_install() {
            distutils-r1_src_install
            mv "${ED}"/usr/bin/{,python-}dotenv || die
          }
    - gpep517:
        requires_python_override: ">=3.7"
        du_pep517: 'no'
        pydeps:
          - installer
          - tomli
        body: |
          python_install() {
            python_domodule gpep517
            python_newscript - gpep517 <<-EOF
              #!${EPREFIX}/usr/bin/python
              import sys
              from gpep517.__main__ import main
              sys.exit(main())
            EOF
          }
    - pycups:
        du_pep517: setuptools
        iuse: examples
        rdepend: 'net-print/cups'
        body: |
          python_install_all() {
            distutils-r1_python_install_all
            if use examples; then
              dodoc -r examples
              docompress -x /usr/share/doc/${PF}
            fi
          }
    # This is a hard-coded ebuild for now... See FL-10181:
    # - installer:
    - maturin:
        cat: dev-util
        extensions:
          - rust
        inherit:
          - cargo
        pydeps:
          py:all:
            - tomli
          py:all:build:
            - setuptools-rust


replace_old_stuff_rule:
  generator: pypi-compat-1
  packages:
    - asgiref:
        pydeps:
          - typing-extensions >= 4
    - blinker
    - click 
    - flask:
        pydeps:
          py:all:
            - werkzeug >= 3.0.0
            - jinja2 > 3.1.2
            - itsdangerous >= 2.1.2
            - click >= 8.1.3
            - blinker >= 1.6.2
            - asgiref >= 3.2
            - python-dotenv
          py:3.9:
            - importlib-metadata >= 3.6.0
    - werkzeug:
        pydeps:
          - markupsafe >= 2.1.1

dev_python_autogen_rule:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-1
  packages:
    - async_timeout:
        python_compat: python3+ pypy3
    - authres:
        versions:
          1.1.1:
            python_compat: python2+ pypy3
    - backports-functools-lru-cache:
        python_compat: python2+ pypy{,3}
        pypi_name: backports.functools-lru-cache
    - bitarray:
        python_compat: python2+ pypy3
    - cffi:
        python_compat: python2+ pypy{,3}
    - cloudflare
    - daemonize:
        python_compat: python2+ pypy3
    - defusedxml:
        python_compat: python2+ pypy{,3}
    - dns-lexicon
    - feedgenerator:
        python_compat: python2+ pypy{,3}
    - flask-jwt:
        python_compat: python2+ pypy{,3}
    - h5py:
        python_compat: python2+ pypy{,3}
    - imagesize:
        python_compat: python2+ pypy{,3}
    - ipy:
        python_compat: python2+ pypy{,3}
    - matplotlib:
        python_compat: python3+ pypy3
        version: 3.5.3
    - pandas
    - pycares:
        python_compat: python3+ pypy3
    - pyproject2setuppy:
        python_compat: python3+ pypy3
    - pyxdg:
        python_compat: python2+ pypy3
    - toml:
        python_compat: python2+ pypy3
    - testresources:
        python_compat: python2+ pypy{,3}
    - testscenarios:
        python_compat: python3+ pypy3
    - readme_renderer:
        python_compat: python2+ pypy3
    - multidict
    - numpy:
        # FL-9243: numpy >=1.22.0 only supports Python >=3.8
        version: 1.21.5
    - flake8-polyfill:
        python_compat: python2+
    - PySocks:
        python_compat: python2+ pypy{,3}
    - dbus-python:
        version: 1.2.18
        python_compat: python2+ pypy{,3}
    - enum34:
        python_compat: python2_7 pypy
    - freezegun:
        python_compat: python3+ pypy3
    - ipaddress:
        python_compat: python2+ pypy{,3}
    - lxml:
        python_compat: python2+ pypy3
    - pyblake2:
        python_compat: python2+ pypy{,3}
    - pycparser:
        python_compat: python2+ pypy{,3}
    - python-gnupg:
        python_compat: python3+ pypy3
    - ply:
        python_compat: python2+ pypy{,3}
    - pyelftools:
        python_compat: python2+ pypy{,3}
    - secretstorage:
        python_compat: python3+ pypy3
    - six:
        python_compat: python2+ pypy{,3}
    - snowballstemmer:
        python_compat: python2+ pypy{,3}
    - wcwidth:
        python_compat: python2+ pypy3
    - wstools:
        python_compat: python2+
    - yarl
    - zope-component:
        python_compat: python2+ pypy3
    - zope-configuration:
        python_compat: python2+ pypy3
    - zope-deferredimport:
        python_compat: python2+ pypy3
    - zope-deprecation:
        python_compat: python3+ pypy3
    - zope-event:
        python_compat: python2+ pypy3
    - zope-exceptions:
        python_compat: python2+ pypy3
    - zope-hookable:
        version: "5.2"
        python_compat: python2+ pypy3
    - zope-interface:
        python_compat: python2+ pypy3
        version: "6.3"
    - zope-i18nmessageid:
        version: "5.0.1"
        python_compat: python2+ pypy3
    - zope-location:
        python_compat: python2+ pypy3
    - zope-proxy:
        version: 4.5.0
        python_compat: python2+ pypy3
    - zope-schema:
        python_compat: python2+ pypy3
    - zope-testing:
        python_compat: python2+ pypy3
    - zope-testrunner:
        python_compat: python2+ pypy3
    - cheroot:
        python_compat: python2+ pypy3
    - aiofiles
    - aiologger
    - html2text:
        python_compat: python3+ pypy3
    - html5-parser
    - isort:
        python_compat: python3+ pypy3
    - mechanize
    - cycler:
        pypi_name: Cycler
    - kiwisolver


stuff_from_next:
  defaults:
    python_compat: python2+ pypy3 pypy
  generator: pypi-compat-1
  packages:
    - wheel:
        compat: '0.37.1'
        du_pep517: flit
        blocker: '!<dev-python/wheel-0.38.2-r1'
        revision:
          0.38.2: 1
          0.43.0: 1
        desc: reference implementation of the Python wheel packaging standard, as defined in PEP 427

dev_python_pillow_rule:
  defaults:
    cat: dev-python
    python_compat: python3+
  generator: pypi-compat-1
  packages:
    - pillow:
        python_compat: python3+
        desc: Python Imaging Library (fork)
        homepage: https://python-pillow.org/
        license: HPND
        iuse: 'examples imagequant +jpeg jpeg2k lcms test tiff tk truetype webp xcb zlib'
        depend: |
          imagequant? ( media-gfx/libimagequant )
          jpeg? ( media-libs/libjpeg-turbo )
          jpeg2k? ( media-libs/openjpeg )
          lcms? ( media-libs/lcms )
          tiff? ( media-libs/tiff )
          truetype? ( media-libs/freetype )
          webp? ( media-libs/libwebp )
          xcb? ( x11-libs/libxcb )
          zlib? ( sys-libs/zlib )
        pydeps:
          py:all:
            - olefile
    - olefile:
        python_compat: python3+
        desc: Python package to parse, read and write Microsoft OLE2 files
        homepage: |
          https://www.decalage.info/olefile/
          https://github.com/decalage2/olefile/
          https://pypi.org/project/olefile/
        license: BSD-2

ansible_deps_rule:
  generator: pypi-compat-1
  defaults:
    cat: dev-python
    python_compat: python2+
    du_pep517: generator
  packages:
    - httplib2:
        pydeps:
          - pyparsing
    - netaddr
    - pynacl:
        body: |
          S="${WORKDIR}/PyNaCl-${PV}"
        rdepend: |
          dev-libs/libsodium

yq_deps_rule:
  generator: pypi-compat-1
  defaults:
    cat: dev-python
    python_compat: python3+
    du_pep517: generator
  packages:
    - argcomplete

python-dateutil_rule:
  generator: pypi-compat-1
  defaults:
    cat: dev-python
    python_compat: python2+
    du_pep517: generator
  packages:
    - python-dateutil
