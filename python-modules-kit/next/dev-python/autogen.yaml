# Note that the following packages are specific to Python 2.7, so we will not be porting these
# to autogen, even though they are on stage3's with python2.7 enabled:
#
# python2 things that will go away:
# - backports
# - configparser
# - contextlib2
# - functools32
# - future
# - pathlib2
#
#
#
# Here are some things that we should autogen that are on stage3:

autogens:
  defaults:
    python_compat: python2+ pypy3 pypy
  generator: pypi-compat-1
  packages:
    - commonmark:
        pydeps:
          py:2:
            - future
          py:all:build:
            - setuptools
        body: |
          src_prepare() {
            default
            # Fix file collision with app-text/cmark, see bug #627034
            sed -i -e "s:'cmark\( = commonmark.cmark\:main'\):'cmark.py\1:" setup.py || die
          }

          pkg_postinst() {
                  ewarn "/usr/bin/cmark has been renamed to /usr/bin/cmark.py due file"
                  ewarn "collision with app-text/cmark (see bug #627034)"
          }
    - jsonpointer:
        pydeps:
          py:all:build:
            - setuptools
    - regex:
        compat: 2020.9.27
        blocker: '!<dev-python/regex-2018'
    - rfc3339-validator:
        pypi_name: rfc3339_validator
        pydeps:
          - strict-rfc3339
          - six
    - rfc3986-validator:
        pypi_name: rfc3986_validator
        pydeps:
          - six
        body: |
          python_prepare_all() {
            # remove dep on pytest-runner
            sed -i -r "s:('|\")pytest-runner('|\")(,|)::" setup.py || die
            distutils-r1_python_prepare_all
          }
    - strict-rfc3339
    - scandir
    - webcolors:
        compat: '1.9'
        blocker: '!<dev-python/webcolors-1.9'
    - zipp:
        compat: 1.2.0
        blocker: '!<dev-python/zipp-0.8'

pypi_simple_rule:
  generator: pypi-simple-1
  packages:
    - pyicu:
        pypi_name: PyICU
        python_compat: python3+
        patches:
          - pyicu-2.10-fix_displayoptions.patch
        rdepend: |
          dev-libs/icu:=
        body: |
          DOCS=( CHANGES CREDITS README.md )


pypi_compat_rule:
  defaults:
    python_compat: python3+
  generator: pypi-compat-1
  packages:
    - ruamel-yaml:
        pypi_name: ruamel.yaml
        desc: YAML parser/emitter that supports roundtrip preservation of comments, seq/map flow style, and map key order
        iuse: test
        pydeps:
          use:test:
            - flake8
            - pytest
            - ruamel-std-pathlib
          py:all:build:
            - setuptools
        body: |
          python_install() {
            distutils-r1_python_install --single-version-externally-managed
            find "${ED}" -name '*.pth' -delete || die
          }

          python_test() {
            # This file produced by setup.py breaks finding system-wide installed ruamel.std.pthlib
            # due to shared namespace
            rm "${BUILD_DIR}/lib/ruamel/__init__.py" || die

            py.test -v _test/test_*.py || die
          }
    - ruamel-std-pathlib:
        pypi_name: ruamel.std.pathlib
        desc: improvements over the standard pathlib module
        iuse: test
        pydeps:
          use:test:
            - flake8
            - pytest
          py:all:build:
            - setuptools
        body: |
          python_install() {
            distutils-r1_python_install --single-version-externally-managed
            find "${ED}" -name '*.pth' -delete || die
          }

          python_test() {
            # This file produced by setup.py breaks finding system-wide installed ruamel.std.pthlib
            # due to shared namespace
            rm "${BUILD_DIR}/lib/ruamel/__init__.py" || die

            py.test -v _test/test_*.py || die
          }
    - llfuse:
        desc: Python bindings for the low level FUSE API
        iuse: doc examples test
        pydeps:
          use:test:
            - pytest
          py:all:build:
            - setuptools
        rdepend: |
            sys-fs/fuse
        depend: |
            sys-apps/attr
            virtual/pkgconfig
        body: |
          python_test() {
            py.test -v || die "Tests failed under ${EPYTHON}"
          }

          python_install_all() {
            use doc && local HTML_DOCS=( doc/html/. )
            use examples && dodoc -r examples
            distutils-r1_python_install_all
          }

